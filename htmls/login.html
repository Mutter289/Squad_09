<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banese Card Login</title>
    <link rel="stylesheet" href="../csss/login.css">
    <link rel="shortcut icon" href="static/img/Dashboard/logo1.jpeg" type="image/x-icon">
</head>
<body>
    <div class="container">
        <div class="login-box">
            <div class="login-form">
                <img src="../imgs/dashboard/baneseCard.png" alt="Banese Card Logo" class="logo">
                <form id="loginForm">
                    <div class="input-gestor">
                        <input
                          type="text"
                          id="id-gestor"
                          placeholder="Digite o seu ID"
                          class="input"
                          required
                        />
                        <label for="id-gestor">ID Gestor</label>
                    </div>
                    <div class="input-gestor">
                        <input
                          type="password"
                          id="senha"
                          placeholder="Digite sua senha"
                          class="input"
                          required
                        />
                        <label for="senha">Senha</label>
                    </div>
                    <button type="submit" class="sign-in-btn">Login</button>
                </form>
                <div id="message" style="color: red;"></div>
            </div>
            <div class="admin-box">
                <h2 id="bem-vindo">Bem-vindo, Gestor!</h2>
                <p id="pronto">Pronto para fazer acontecer?</p>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Evita o envio padrão do formulário
    
            const username = document.getElementById('id-gestor').value; // id-gestor (nome de usuário)
            const password = document.getElementById('senha').value; // Senha
    
            // Abrindo o banco de dados IndexedDB
            const request = indexedDB.open("gestoresDB", 1);
    
            request.onerror = function(event) {
                console.error("Erro ao abrir o banco de dados:", event.target.error);
                document.getElementById('message').textContent = 'Erro ao acessar os dados do banco de dados.';
            };
    
            request.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction("gestores", "readonly");
                const objectStore = transaction.objectStore("gestores");
    
                // Criando um índice para procurar pelo nome do gestor
                const index = objectStore.index("nome");
    
                // Buscando o gestor pelo nome (id-gestor)
                const getRequest = index.get(username);
    
                getRequest.onerror = function() {
                    console.error("Erro ao acessar o índice para buscar o gestor.");
                    document.getElementById('message').textContent = 'Erro ao acessar os dados do gestor.';
                };
    
                getRequest.onsuccess = function() {
                    const gestor = getRequest.result;
    
                    // Verificando se o gestor foi encontrado e a senha corresponde
                    if (gestor) {
                        if (gestor.senha === password) {
                            // Salva o estado de autenticação no localStorage
                            localStorage.setItem("isAuthenticated", "true");
                            localStorage.setItem("gestorNome", gestor.nome);
                            localStorage.setItem("gestorId", gestor.id);
    
                            // Redirecionar para a nova página
                            window.location.href = "../index.html"; // Caminho correto para a página desejada
                        } else {
                            document.getElementById('message').textContent = 'Credenciais inválidas. Tente novamente.';
                        }
                    } else {
                        document.getElementById('message').textContent = 'Gestor não encontrado.';
                    }
                };
            };
        });
    </script>
    
</body>
</html>
